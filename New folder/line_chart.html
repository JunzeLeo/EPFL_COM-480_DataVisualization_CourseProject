<!DOCTYPE html>
<meta charset="utf-8">

<style>

body { font: 12px Arial;}

path {
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
}

.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}

</style>

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="double_axis_line_chart"></div>

<!--  -->
<script>

// Define the figure size
var margin = {top: 30, right: 100, bottom: 30, left: 50},
    width = 420 - margin.left - margin.right,
    height = 270 - margin.top - margin.bottom;

// var formatYear = d3.timeFormat("%Y");
// Define the scales of axises
var x = d3.scaleLinear().range([0, width]);
var y0 = d3.scaleLinear().range([height, 0]);
var y1 = d3.scaleLinear().range([height, 0]);

// Plot the axises
// var xAxis = d3.svg.axis().scale(x)
//     .orient("bottom").ticks(5);
var xAxis = d3.axisBottom(x).tickFormat(function(d) { return d;});

// var yAxisLeft = d3.svg.axis().scale(y0)
//     .orient("left").ticks(5);
var yAxisLeft = d3.axisLeft(y0).ticks(5);

// var yAxisRight = d3.svg.axis().scale(y1)
//     .orient("right").ticks(5);
var yAxisRight = d3.axisRight(y1).ticks(5);

// Define two functions to draw two lines
var valueline = d3.line()
    .x(function(d) { return x(d.Year); })
    .y(function(d) { return y0(d.forest_coverage); });

var valueline2 = d3.line()
    .x(function(d) { return x(d.Year); })
    .y(function(d) { return y1(d.co2_emission); });

var svg = d3.select("body")
    .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
    .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");

// Load the data
d3.csv("china_data.csv", function(error, data) {
    data.forEach(function(d) {
        d.Year = +d.Year;
        d.forest_coverage = +d.forest_coverage;
        d.co2_emission = +d.co2_emission;
    });

    // Scale the range of the data
    x.domain(d3.extent(data, function(d) { return d.Year;}));
    y0.domain([d3.min(data, function(d) {
		return Math.min(d.forest_coverage); }), d3.max(data, function(d) {
		return Math.min(d.forest_coverage); })]);
    y1.domain([d3.min(data, function(d) {
		return Math.min(d.co2_emission); }), d3.max(data, function(d) {
		return Math.max(d.co2_emission); })]);


    var focus = svg.append("g");
                // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var line1 = focus.append("path")
	    .datum(data)
	    .attr("fill", "none")
	    .attr("stroke", "steelblue")
	    .attr("stroke-linejoin", "round")
	    .attr("stroke-linecap", "round")
	    .attr("stroke-width", 1.5)
	    .attr("d", valueline);

	var totalLength1 = line1.node().getTotalLength();

       line1.attr("stroke-dasharray", totalLength1)
        .attr("stroke-dashoffset", totalLength1)
        .transition()
            .duration(2000)
            .attr('stroke-dashoffset', 0);

	var line2 = focus.append("path")
        .datum(data)
        .attr("fill", "none")
        .style("stroke", "red")
        .attr("stroke", "green")
        .attr("stroke-linejoin", "round")
        .attr("stroke-linecap", "round")
        .attr("stroke-width", 1.5)
        .attr("d", valueline2)

    var totalLength2 = line2.node().getTotalLength();

       line2.attr("stroke-dasharray", totalLength2)
        .attr("stroke-dashoffset", totalLength2)
        .transition()
            .duration(2000)
            .attr('stroke-dashoffset', 0);

    // Add the axises
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);

    svg.append("g")
        .attr("class", "y axis")
        .style("fill", "steelblue")
        .call(yAxisLeft);

    svg.append("g")
        .attr("class", "y axis")
        .attr("transform", "translate(" + width + " ,0)")
        .style("fill", "red")
        .call(yAxisRight);

	});


</script>
